<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tiramissu' - –ó–∞–∫–∞–∑</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --candy: #D54D31;
            --candy-light: #e05a3f;
            --sugar: #FFF7F5;
            --onyx: #080F0D;
            --sky: #C4E0E6;
            --gray-light: #f5f0ee;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ubuntu', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--sugar);
            color: var(--onyx);
            padding: 0;
            padding-bottom: 100px;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 16px 16px 16px;
        }

        /* –®–∞–ø–∫–∞ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º */
        .header {
            background: var(--sugar);
            padding: 16px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo-text {
            font-family: 'Ubuntu', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: var(--candy);
            text-align: center;
        }

        .tagline {
            font-size: 13px;
            color: var(--candy);
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: lowercase;
        }

        h2 {
            font-size: 18px;
            font-weight: 700;
            margin: 20px 0 12px 0;
            color: var(--onyx);
        }

        /* –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞ */
        .client-type {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .client-btn {
            flex: 1;
            padding: 14px 10px;
            border: 2px solid var(--candy);
            background: var(--candy);
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .client-btn.active {
            background: white;
            color: var(--candy);
        }

        .client-btn:hover:not(.active) {
            background: var(--candy-light);
        }

        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ */
        .product-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(213, 77, 49, 0.08);
            border: 1px solid rgba(213, 77, 49, 0.1);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .product-name {
            font-weight: 600;
            font-size: 15px;
            color: var(--onyx);
        }

        .product-price {
            font-weight: 700;
            font-size: 15px;
            color: var(--candy);
        }

        /* –°—á—ë—Ç—á–∏–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ */
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: none;
            background: var(--candy);
            color: white;
            font-size: 22px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .qty-btn:hover {
            background: var(--candy-light);
            transform: scale(1.05);
        }

        .qty-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .qty-value {
            font-size: 20px;
            font-weight: 700;
            min-width: 40px;
            text-align: center;
            color: var(--onyx);
        }

        .qty-label {
            font-size: 14px;
            color: var(--candy);
            font-weight: 500;
            margin-left: auto;
        }

        /* –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
        .input-group {
            margin-bottom: 14px;
        }

        .input-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--onyx);
        }

        .input-group label .required {
            color: var(--candy);
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 16px;
            background: white;
            color: var(--onyx);
            transition: border-color 0.2s;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--candy);
        }

        .input-group input.error, .input-group textarea.error {
            border-color: var(--candy);
            background: rgba(213, 77, 49, 0.05);
        }

        .input-group input::placeholder, .input-group textarea::placeholder {
            color: #aaa;
        }

        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* –ò—Ç–æ–≥–æ */
        .summary {
            background: white;
            border-radius: 16px;
            padding: 18px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(213, 77, 49, 0.08);
            border: 2px solid var(--candy);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-row.total {
            font-weight: 700;
            font-size: 16px;
            color: var(--candy);
        }

        /* –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .category-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .category-card {
            background: white;
            border-radius: 20px;
            padding: 24px 16px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(213, 77, 49, 0.1);
            border: 2px solid transparent;
            text-align: center;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .category-card:hover {
            border-color: var(--candy);
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(213, 77, 49, 0.2);
        }

        .category-card:active {
            transform: scale(0.96);
        }

        .category-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .category-title {
            font-weight: 700;
            font-size: 16px;
            color: var(--onyx);
            line-height: 1.3;
        }

        .category-subtitle {
            font-size: 12px;
            color: #888;
            margin-top: 6px;
        }

        /* –°—Ç–∞—Ä—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) */
        .retail-card {
            background: white;
            padding: 18px;
            border-radius: 16px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(213, 77, 49, 0.08);
            border: 1px solid rgba(213, 77, 49, 0.1);
        }

        .retail-card:hover {
            border-color: var(--candy);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(213, 77, 49, 0.15);
        }

        .retail-card:active {
            transform: scale(0.98);
        }

        .retail-card strong {
            color: var(--onyx);
            font-size: 16px;
        }

        .retail-card p {
            font-size: 13px;
            color: #888;
            margin-top: 4px;
        }

        .hidden {
            display: none !important;
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .date-section {
            margin-bottom: 20px;
        }

        .date-input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 16px;
            background: white;
            color: var(--onyx);
            margin-bottom: 12px;
            transition: border-color 0.2s;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--candy);
        }

        .date-input.error {
            border-color: var(--candy);
            background: rgba(213, 77, 49, 0.05);
        }

        /* –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤–æ–∫ */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .day-btn {
            padding: 12px 4px;
            border: 2px solid var(--candy);
            background: transparent;
            border-radius: 10px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 12px;
            font-weight: 700;
            color: var(--candy);
            cursor: pointer;
            transition: all 0.2s;
        }

        .day-btn.selected {
            background: var(--candy);
            color: white;
        }

        .day-btn:hover:not(.selected) {
            background: rgba(213, 77, 49, 0.1);
        }

        .error-message {
            color: var(--candy);
            font-size: 13px;
            font-weight: 500;
            margin-top: 8px;
            padding: 12px;
            background: rgba(213, 77, 49, 0.1);
            border-radius: 10px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .section-hint {
            font-size: 13px;
            color: #888;
            margin-bottom: 16px;
        }

        /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç */
        .decoration {
            text-align: center;
            margin: 20px 0;
            color: var(--candy);
            opacity: 0.3;
        }

        /* –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ */
        .back-btn {
            background: none;
            border: none;
            color: var(--candy);
            font-family: 'Ubuntu', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 0;
            margin-bottom: 8px;
        }

        .back-btn:hover {
            text-decoration: underline;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ */
        .selected-product-card {
            background: var(--candy);
            color: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .selected-product-name {
            font-weight: 700;
            font-size: 16px;
        }

        .selected-product-price {
            font-weight: 700;
            font-size: 16px;
        }

        /* –°–µ–ª–µ–∫—Ç–æ—Ä –≤–µ—Å–∞ */
        .weight-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .weight-btn {
            flex: 1;
            min-width: 60px;
            padding: 12px 8px;
            border: 2px solid var(--candy);
            background: transparent;
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--candy);
            cursor: pointer;
            transition: all 0.2s;
        }

        .weight-btn.selected {
            background: var(--candy);
            color: white;
        }

        .weight-btn:hover:not(.selected) {
            background: rgba(213, 77, 49, 0.1);
        }

        /* –ö–Ω–æ–ø–∫–∞ Big size */
        .big-size-btn {
            width: 100%;
            padding: 14px;
            margin-top: 10px;
            border: 2px solid var(--candy);
            background: transparent;
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--candy);
            cursor: pointer;
            transition: all 0.2s;
        }

        .big-size-btn.selected {
            background: var(--candy);
            color: white;
        }

        .big-size-btn:hover:not(.selected) {
            background: rgba(213, 77, 49, 0.1);
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≤–µ—Å–∞ */
        .custom-weight-input {
            display: none;
            margin-top: 10px;
        }

        .custom-weight-input.show {
            display: block;
        }

        .custom-weight-input input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--candy);
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 16px;
            background: white;
            color: var(--onyx);
            text-align: center;
        }

        .custom-weight-input input:focus {
            outline: none;
        }

        .custom-weight-hint {
            font-size: 12px;
            color: #888;
            text-align: center;
            margin-top: 6px;
        }

        /* –í—ã–±–æ—Ä —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ */
        .delivery-type-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .delivery-type-btn {
            flex: 1;
            padding: 14px 10px;
            border: 2px solid var(--candy);
            background: transparent;
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--candy);
            cursor: pointer;
            transition: all 0.2s;
        }

        .delivery-type-btn.selected {
            background: var(--candy);
            color: white;
        }

        .delivery-type-btn:hover:not(.selected) {
            background: rgba(213, 77, 49, 0.1);
        }

        .pickup-address {
            background: var(--gray-light);
            padding: 14px;
            border-radius: 12px;
            font-size: 14px;
            color: var(--onyx);
            display: none;
        }

        .pickup-address.show {
            display: block;
        }

        .pickup-address-icon {
            margin-right: 8px;
        }

        /* –ö–æ—Ä–∑–∏–Ω–∞ */
        .cart-badge {
            position: fixed;
            top: 16px;
            right: 16px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--candy);
            color: var(--candy);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(213, 77, 49, 0.15);
            cursor: pointer;
            z-index: 100;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .cart-badge.show {
            display: flex;
        }

        .cart-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(213, 77, 49, 0.25);
            background: rgba(255, 255, 255, 1);
        }

        .cart-count {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--candy);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        .cart-item {
            background: white;
            border-radius: 16px;
            padding: 14px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(213, 77, 49, 0.08);
            border: 1px solid rgba(213, 77, 49, 0.1);
            position: relative;
        }

        .cart-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            padding-right: 30px;
        }

        .cart-item-name {
            font-weight: 700;
            font-size: 15px;
            color: var(--onyx);
            flex: 1;
        }

        .cart-item-price {
            font-weight: 700;
            font-size: 15px;
            color: var(--candy);
            margin-left: 10px;
        }

        .cart-item-details {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .cart-item-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: #999;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }

        .cart-item-remove:hover {
            color: var(--candy);
        }

        .add-more-btn {
            width: 100%;
            padding: 14px;
            border: 2px dashed var(--candy);
            background: transparent;
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--candy);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 20px;
        }

        .add-more-btn:hover {
            background: rgba(213, 77, 49, 0.05);
        }

        /* –°–µ–ª–µ–∫—Ç –≤—Ä–µ–º–µ–Ω–∏ */
        .time-select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--gray-light);
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 16px;
            background: white;
            color: var(--onyx);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23D54D31' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
        }

        .time-select:focus {
            outline: none;
            border-color: var(--candy);
        }

        .time-select.error {
            border-color: var(--candy);
            background-color: rgba(213, 77, 49, 0.05);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–∞—á–∏–Ω–∫–∏ */
        .flavor-card {
            background: white;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(213, 77, 49, 0.08);
            border: 1px solid rgba(213, 77, 49, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flavor-card:hover {
            border-color: var(--candy);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(213, 77, 49, 0.15);
        }

        .flavor-card:active {
            transform: scale(0.98);
        }

        .flavor-name {
            font-weight: 600;
            font-size: 15px;
            color: var(--onyx);
        }

        .flavor-price {
            font-weight: 700;
            font-size: 15px;
            color: var(--candy);
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ */
        .photo-upload-btn {
            width: 100%;
            padding: 14px;
            border: 2px dashed var(--candy);
            background: transparent;
            border-radius: 12px;
            font-family: 'Ubuntu', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--candy);
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .photo-upload-btn:hover {
            background: rgba(213, 77, 49, 0.05);
            border-color: var(--candy-light);
        }

        .photos-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 12px;
        }

        .photo-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--gray-light);
        }

        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview-item .photo-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .photo-preview-item .photo-remove:hover {
            background: var(--candy);
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <div class="logo-text">tiramiss'u</div>
        <div class="tagline">only cake</div>
    </div>

    <div class="container">
        <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞ -->
        <div class="client-type">
            <button class="client-btn" onclick="switchSection('retail')">–ó–∞–∫–∞–∑</button>
            <button class="client-btn active" onclick="switchSection('b2b')">B2B –û–ø—Ç</button>
        </div>

        <!-- B2B –°–µ–∫—Ü–∏—è -->
        <div id="b2b-section" class="section active">
            <h2>–û–ø—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
            <p class="section-hint">
                –£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–∫–≥)
            </p>

            <div id="products-list">
                <!-- –ü—Ä–æ–¥—É–∫—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>

            <h2>–î–∞—Ç—ã –ø–æ—Å—Ç–∞–≤–∫–∏</h2>

            <div class="date-section">
                <div class="input-group">
                    <label>–ü–µ—Ä–≤–∞—è –ø–æ—Å—Ç–∞–≤–∫–∞ <span class="required">*</span></label>
                    <input type="date" id="first-delivery" class="date-input" min="">
                </div>

                <p class="section-hint">
                    –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –¥–Ω–∏ –ø–æ—Å—Ç–∞–≤–æ–∫:
                </p>
                <div class="days-grid">
                    <button class="day-btn" data-day="–ø–Ω" onclick="toggleDay(this)">–ü–Ω</button>
                    <button class="day-btn" data-day="–≤—Ç" onclick="toggleDay(this)">–í—Ç</button>
                    <button class="day-btn" data-day="—Å—Ä" onclick="toggleDay(this)">–°—Ä</button>
                    <button class="day-btn" data-day="—á—Ç" onclick="toggleDay(this)">–ß—Ç</button>
                    <button class="day-btn" data-day="–ø—Ç" onclick="toggleDay(this)">–ü—Ç</button>
                    <button class="day-btn" data-day="—Å–±" onclick="toggleDay(this)">–°–±</button>
                    <button class="day-btn" data-day="–≤—Å" onclick="toggleDay(this)">–í—Å</button>
                </div>
            </div>

            <h2>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
            <div class="input-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ <span class="required">*</span></label>
                <input type="text" id="company-name" placeholder="–û–û–û –†–æ–º–∞—à–∫–∞">
            </div>
            <div class="input-group">
                <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω <span class="required">*</span></label>
                <input type="tel" id="phone" placeholder="+7 (999) 123-45-67">
            </div>
            <div class="input-group">
                <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ <span class="required">*</span></label>
                <input type="text" id="address" placeholder="—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1">
            </div>
            <div class="input-group">
                <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
                <textarea id="comment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
            </div>

            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ-—Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤ -->
            <div class="input-group">
                <label>–§–æ—Ç–æ-—Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <p class="section-hint">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</p>
                <input type="file" id="b2b-photos" accept="image/*" multiple style="display: none;" onchange="handlePhotoUpload(this, 'b2b')">
                <button type="button" class="photo-upload-btn" onclick="document.getElementById('b2b-photos').click()">
                    üì∑ –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                </button>
                <div class="photos-preview" id="b2b-photos-preview"></div>
            </div>

            <div class="error-message" id="error-message">
                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            </div>

            <div class="summary" id="summary">
                <div class="summary-row">
                    <span>–í—ã–±—Ä–∞–Ω–æ:</span>
                    <span id="total-items">0 –ø–æ–∑. / 0 —à—Ç</span>
                </div>
                <div class="summary-row total">
                    <span>–ò—Ç–æ–≥–æ:</span>
                    <span id="total-price">0 ‚ÇΩ</span>
                </div>
            </div>
        </div>

        <!-- –†–æ–∑–Ω–∏—Ü–∞ –°–µ–∫—Ü–∏—è -->
        <div id="retail-section" class="section">
            <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div id="retail-step1">
                <div class="category-grid">
                    <div class="category-card" onclick="selectRetailCategory('cake')">
                        <div class="category-icon">üéÇ</div>
                        <div class="category-title">–¢–æ—Ä—Ç—ã<br>–Ω–∞ –∑–∞–∫–∞–∑</div>
                        <div class="category-subtitle">–æ—Ç 1 –∫–≥</div>
                    </div>

                    <div class="category-card" onclick="selectRetailCategory('bento')">
                        <div class="category-icon">üç∞</div>
                        <div class="category-title">–ë–µ–Ω—Ç–æ<br>–Ω–∞ –∑–∞–∫–∞–∑</div>
                        <div class="category-subtitle">800 –≥—Ä</div>
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä –Ω–∞—á–∏–Ω–∫–∏ -->
            <div id="retail-step2" class="hidden">
                <button class="back-btn" onclick="retailGoBack(1)">‚Üê –ù–∞–∑–∞–¥</button>
                <h2 id="retail-category-title">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∏–Ω–∫—É</h2>
                <p class="section-hint" id="retail-category-hint">
                    –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∏–Ω–∫—É –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–æ—Ä—Ç–∞
                </p>

                <div id="retail-flavors-list">
                    <!-- –ù–∞—á–∏–Ω–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –®–∞–≥ 3: –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ (–≤–µ—Å/–¥–µ–∫–æ—Ä) -->
            <div id="retail-step3" class="hidden">
                <button class="back-btn" onclick="retailGoBack(2)">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>–î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞</h2>

                <div class="selected-product-card">
                    <div class="selected-product-name" id="selected-flavor-name">‚Äî</div>
                    <div class="selected-product-price" id="selected-flavor-price">‚Äî</div>
                </div>

                <!-- –í–µ—Å (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ—Ä—Ç–æ–≤) -->
                <div id="weight-section" class="input-group">
                    <label>–í–µ—Å —Ç–æ—Ä—Ç–∞ <span class="required">*</span></label>
                    <div class="weight-selector">
                        <button class="weight-btn" data-weight="1" onclick="selectWeight(1)">1 –∫–≥</button>
                        <button class="weight-btn" data-weight="1.5" onclick="selectWeight(1.5)">1.5 –∫–≥</button>
                        <button class="weight-btn" data-weight="2" onclick="selectWeight(2)">2 –∫–≥</button>
                        <button class="weight-btn" data-weight="2.5" onclick="selectWeight(2.5)">2.5 –∫–≥</button>
                        <button class="weight-btn" data-weight="3" onclick="selectWeight(3)">3 –∫–≥</button>
                    </div>
                    <button class="big-size-btn" onclick="toggleBigSize()">üéÇ Big size ‚Äî —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–π –≤–µ—Å</button>
                    <div class="custom-weight-input" id="custom-weight-container">
                        <input type="number" id="custom-weight" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –≤ –∫–≥" step="0.5" min="3.5" oninput="updateCustomWeight()">
                        <div class="custom-weight-hint">–£–∫–∞–∂–∏—Ç–µ –≤–µ—Å –æ—Ç 3.5 –∫–≥ –∏ –±–æ–ª–µ–µ</div>
                    </div>
                </div>

                <!-- –î–µ–∫–æ—Ä -->
                <div class="input-group">
                    <label>–î–µ–∫–æ—Ä / –ù–∞–¥–ø–∏—Å—å <span class="required">*</span></label>
                    <textarea id="retail-decor" placeholder="–û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ, –Ω–∞–¥–ø–∏—Å—å –Ω–∞ —Ç–æ—Ä—Ç–µ..."></textarea>
                </div>

                <div class="error-message" id="retail-step3-error">
                    –£–∫–∞–∂–∏—Ç–µ –≤–µ—Å –∏ –¥–µ–∫–æ—Ä
                </div>

                <div class="summary" id="retail-summary">
                    <div class="summary-row">
                        <span id="retail-summary-product">‚Äî</span>
                        <span id="retail-summary-weight">‚Äî</span>
                    </div>
                    <div class="summary-row total">
                        <span>–ò—Ç–æ–≥–æ:</span>
                        <span id="retail-total-price">0 ‚ÇΩ</span>
                    </div>
                </div>
            </div>

            <!-- –®–∞–≥ 4: –ö–æ—Ä–∑–∏–Ω–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ -->
            <div id="retail-step4" class="hidden">
                <button class="back-btn" onclick="retailGoBack(3)">‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä—É</button>
                <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>

                <div id="cart-items-list">
                    <!-- –¢–æ–≤–∞—Ä—ã –∫–æ—Ä–∑–∏–Ω—ã -->
                </div>

                <button class="add-more-btn" onclick="addMoreItems()">+ –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ç–æ—Ä—Ç</button>

                <h2>–î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞</h2>

                <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è -->
                <div class="input-group">
                    <label>–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è <span class="required">*</span></label>
                    <input type="date" id="retail-date" class="date-input">
                </div>
                <div class="input-group">
                    <label>–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è <span class="required">*</span></label>
                    <select id="retail-time" class="time-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="13:00">13:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                        <option value="18:00">18:00</option>
                        <option value="19:00">19:00</option>
                        <option value="20:00">20:00</option>
                        <option value="21:00">21:00</option>
                    </select>
                </div>

                <!-- –°–∞–º–æ–≤—ã–≤–æ–∑ / –î–æ—Å—Ç–∞–≤–∫–∞ -->
                <div class="input-group">
                    <label>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è <span class="required">*</span></label>
                    <div class="delivery-type-selector">
                        <button class="delivery-type-btn selected" onclick="selectDeliveryType('pickup')">üìç –°–∞–º–æ–≤—ã–≤–æ–∑</button>
                        <button class="delivery-type-btn" onclick="selectDeliveryType('delivery')">üöó –î–æ—Å—Ç–∞–≤–∫–∞</button>
                    </div>
                    <div class="pickup-address show" id="pickup-address-block">
                        <span class="pickup-address-icon">‚òï</span>
                        –ö–æ—Ñ–µ–π–Ω—è tiramiss'u<br>
                        <strong>–ù–∞–±. –ú–∞—Ä–∫–∞ –®–∞–≥–∞–ª–∞ 1–∫1</strong>
                    </div>
                    <input type="text" id="retail-address" placeholder="—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1, –∫–≤. 10" class="hidden">
                </div>

                <!-- –ò–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω -->
                <div class="input-group">
                    <label>–í–∞—à–µ –∏–º—è <span class="required">*</span></label>
                    <input type="text" id="retail-name" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?">
                </div>
                <div class="input-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω <span class="required">*</span></label>
                    <input type="tel" id="retail-phone" placeholder="+7 (999) 123-45-67">
                </div>

                <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ / –ê–ª–ª–µ—Ä–≥–µ–Ω—ã -->
                <div class="input-group">
                    <label>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ / –ê–ª–ª–µ—Ä–≥–µ–Ω—ã</label>
                    <textarea id="retail-allergies" placeholder="–£–∫–∞–∂–∏—Ç–µ, –µ—Å–ª–∏ –µ—Å—Ç—å –∞–ª–ª–µ—Ä–≥–∏—è –∏–ª–∏ –æ—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
                </div>

                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ-—Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤ -->
                <div class="input-group">
                    <label>–§–æ—Ç–æ-—Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <p class="section-hint">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Ç–æ—Ä—Ç–∞</p>
                    <input type="file" id="retail-photos" accept="image/*" multiple style="display: none;" onchange="handlePhotoUpload(this, 'retail')">
                    <button type="button" class="photo-upload-btn" onclick="document.getElementById('retail-photos').click()">
                        üì∑ –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
                    </button>
                    <div class="photos-preview" id="retail-photos-preview"></div>
                </div>

                <div class="error-message" id="retail-error-message">
                    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
                </div>

                <div class="summary" id="cart-summary">
                    <div class="summary-row">
                        <span>–¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ:</span>
                        <span id="cart-items-count">0</span>
                    </div>
                    <div class="summary-row total">
                        <span>–ò—Ç–æ–≥–æ:</span>
                        <span id="cart-total-price">0 ‚ÇΩ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
    <div class="cart-badge" id="cart-badge" onclick="goToCart()">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
        <div class="cart-count" id="cart-count">0</div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ –±—Ä–µ–Ω–¥
        tg.MainButton.color = '#D54D31';
        tg.MainButton.textColor = '#FFFFFF';

        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe?.user;

        // –ü—Ä–æ–¥—É–∫—Ç—ã B2B —Å —Ü–µ–Ω–∞–º–∏
        const products = [
            { id: 1, name: '–ú–µ–¥–æ–≤–∏–∫', price: 2600 },
            { id: 2, name: '–ß–∏–∑–∫–µ–π–∫ + —è–≥–æ–¥–Ω—ã–π —Å–∏—Ä–æ–ø', price: 3000 },
            { id: 3, name: '–ù–∞–ø–æ–ª–µ–æ–Ω', price: 2600 },
            { id: 4, name: '–¢–æ—Ä—Ç –®–æ–∫–æ–ª–∞–¥-–≤–∏—à–Ω—è', price: 2900 },
            { id: 5, name: '–¢–∏—Ä–∞–º–∏—Å—É –∫–ª–∞—Å—Å–∏–∫–∞', price: 3150 },
            { id: 6, name: '–¢–∏—Ä–∞–º–∏—Å—É —Ñ–∏—Å—Ç–∞—à–∫–∞', price: 3450 },
            { id: 7, name: '–¢–∏—Ä–∞–º–∏—Å—É —è–≥–æ–¥–∞', price: 3300 },
            { id: 8, name: '–¢–∏—Ä–∞–º–∏—Å—É —Å–æ–ª—ë–Ω–∞—è –∫–∞—Ä–∞–º–µ–ª—å', price: 3300 },
            { id: 9, name: '–¢–∏—Ä–∞–º–∏—Å—É –ª–∏–º–æ–Ω', price: 3300 },
            { id: 10, name: '–¢–∏—Ä–∞–º–∏—Å—É –º–∞–∫', price: 3450 }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–∞
        const order = {
            quantities: {},
            firstDelivery: '',
            days: [],
            company: '',
            phone: '',
            address: '',
            comment: ''
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤
        products.forEach(p => order.quantities[p.id] = 0);

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã (—á–µ—Ä–µ–∑ 2 –¥–Ω—è)
        const minDate = new Date();
        minDate.setDate(minDate.getDate() + 2);
        document.getElementById('first-delivery').min = minDate.toISOString().split('T')[0];

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        function renderProducts() {
            const container = document.getElementById('products-list');
            container.innerHTML = products.map(p => `
                <div class="product-card">
                    <div class="product-header">
                        <span class="product-name">${p.name}</span>
                        <span class="product-price">${p.price} ‚ÇΩ</span>
                    </div>
                    <div class="quantity-control">
                        <button class="qty-btn" onclick="changeQty(${p.id}, -1)" ${order.quantities[p.id] === 0 ? 'disabled' : ''}>‚àí</button>
                        <span class="qty-value">${order.quantities[p.id]}</span>
                        <button class="qty-btn" onclick="changeQty(${p.id}, 1)">+</button>
                        <span class="qty-label">—à—Ç</span>
                    </div>
                </div>
            `).join('');
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        function changeQty(productId, delta) {
            order.quantities[productId] = Math.max(0, order.quantities[productId] + delta);
            renderProducts();
            updateSummary();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω—è
        function toggleDay(btn) {
            btn.classList.toggle('selected');
            const day = btn.dataset.day;
            if (btn.classList.contains('selected')) {
                order.days.push(day);
            } else {
                order.days = order.days.filter(d => d !== day);
            }
            updateSummary();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ
        function updateSummary() {
            const totalItems = Object.values(order.quantities).reduce((sum, qty) => sum + (qty > 0 ? 1 : 0), 0);
            const totalQty = Object.values(order.quantities).reduce((sum, qty) => sum + qty, 0);

            // –ü–æ–¥—Å—á—ë—Ç –æ–±—â–µ–π —Å—É–º–º—ã
            let totalPrice = 0;
            products.forEach(p => {
                totalPrice += order.quantities[p.id] * p.price;
            });

            document.getElementById('total-items').textContent = `${totalItems} –ø–æ–∑. / ${totalQty} —à—Ç`;
            document.getElementById('total-price').textContent = `${totalPrice.toLocaleString('ru-RU')} ‚ÇΩ`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã
            if (totalQty > 0) {
                tg.MainButton.text = `–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ ${totalPrice.toLocaleString('ru-RU')} ‚ÇΩ`;
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–π
        function switchSection(section) {
            document.querySelectorAll('.client-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));

            if (section === 'b2b') {
                document.querySelector('.client-btn:last-child').classList.add('active');
                document.getElementById('b2b-section').classList.add('active');
                updateSummary();
            } else {
                document.querySelector('.client-btn:first-child').classList.add('active');
                document.getElementById('retail-section').classList.add('active');
                tg.MainButton.hide();
            }
        }

        // === –†–û–ó–ù–ò–ß–ù–ê–Ø –§–û–†–ú–ê ===

        // –¢–æ—Ä—Ç—ã –Ω–∞ –∑–∞–∫–∞–∑ (—Ü–µ–Ω–∞ –∑–∞ 1 –∫–≥)
        const cakeFlavors = [
            { id: 1, name: '–ú–µ–¥–æ–≤–∏–∫', price: 4200 },
            { id: 2, name: '–°–Ω–∏–∫–µ—Ä—Å', price: 4200 },
            { id: 3, name: '–¢—Ä–∏ —à–æ–∫–æ–ª–∞–¥–∞', price: 4200 },
            { id: 4, name: '–ú–æ–ª–æ—á–Ω–∞—è –¥–µ–≤–æ—á–∫–∞', price: 4200 },
            { id: 5, name: '–†–∞—Ñ–∞—ç–ª–ª–æ', price: 4500 },
            { id: 6, name: '–ß—ë—Ä–Ω–∞—è —Å–º–æ—Ä–æ–¥–∏–Ω–∞ —à–æ–∫–æ–ª–∞–¥', price: 4500 },
            { id: 7, name: '–Ø–≥–æ–¥–∞ –≤–∞–Ω–∏–ª—å', price: 4200 },
            { id: 8, name: '–§–∏—Å—Ç–∞—à–∫–∞ –º–∞–ª–∏–Ω–∞', price: 4500 },
            { id: 9, name: '–ù–∞–ø–æ–ª–µ–æ–Ω', price: 3500 }
        ];

        // –ë–µ–Ω—Ç–æ —Ç–æ—Ä—Ç—ã (800–≥, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞)
        const bentoFlavors = [
            { id: 101, name: '–ú–µ–¥–æ–≤–∏–∫', price: 2500 },
            { id: 102, name: '–°–Ω–∏–∫–µ—Ä—Å', price: 2500 },
            { id: 103, name: '–¢—Ä–∏ —à–æ–∫–æ–ª–∞–¥–∞', price: 2500 },
            { id: 104, name: '–ú–æ–ª–æ—á–Ω–∞—è –¥–µ–≤–æ—á–∫–∞', price: 2500 },
            { id: 105, name: '–†–∞—Ñ–∞—ç–ª–ª–æ', price: 2700 },
            { id: 106, name: '–®–æ–∫–æ–ª–∞–¥-–≤–∏—à–Ω—è', price: 2700 },
            { id: 107, name: '–Ø–≥–æ–¥–∞ –≤–∞–Ω–∏–ª—å', price: 2500 },
            { id: 108, name: '–§–∏—Å—Ç–∞—à–∫–∞ –º–∞–ª–∏–Ω–∞', price: 2700 }
        ];

        // –ö–æ—Ä–∑–∏–Ω–∞ –¥–ª—è —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
        const cart = [];

        // –¢–µ–∫—É—â–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π —Ç–æ–≤–∞—Ä
        const currentItem = {
            category: null, // 'cake' –∏–ª–∏ 'bento'
            flavor: null,
            weight: 1,
            customWeight: false,
            decor: ''
        };

        // –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ (–æ–±—â–∏–µ –¥–ª—è –≤—Å–µ–π –∫–æ—Ä–∑–∏–Ω—ã)
        const retailOrder = {
            deliveryType: 'pickup',
            address: '',
            date: '',
            time: '',
            name: '',
            phone: '',
            allergies: ''
        };

        // –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–æ—Ç–æ (base64)
        const retailPhotos = [];
        const b2bPhotos = [];

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã –¥–ª—è —Ä–æ–∑–Ω–∏—Ü—ã (—á–µ—Ä–µ–∑ 3 –¥–Ω—è)
        const retailMinDate = new Date();
        retailMinDate.setDate(retailMinDate.getDate() + 3);

        // –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function selectRetailCategory(category) {
            currentItem.category = category;
            currentItem.flavor = null;
            currentItem.weight = 1;
            currentItem.customWeight = false;
            currentItem.decor = '';

            document.getElementById('retail-step1').classList.add('hidden');
            document.getElementById('retail-step2').classList.remove('hidden');

            const flavors = category === 'cake' ? cakeFlavors : bentoFlavors;
            const title = category === 'cake' ? '–¢–æ—Ä—Ç –Ω–∞ –∑–∞–∫–∞–∑' : '–ë–µ–Ω—Ç–æ —Ç–æ—Ä—Ç';
            const hint = category === 'cake' ? '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∏–Ω–∫—É (—Ü–µ–Ω–∞ –∑–∞ 1 –∫–≥)' : '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—á–∏–Ω–∫—É (800 –≥—Ä)';

            document.getElementById('retail-category-title').textContent = title;
            document.getElementById('retail-category-hint').textContent = hint;

            renderFlavors(flavors);
        }

        // –†–µ–Ω–¥–µ—Ä –Ω–∞—á–∏–Ω–æ–∫
        function renderFlavors(flavors) {
            const container = document.getElementById('retail-flavors-list');
            const priceLabel = retailOrder.category === 'cake' ? '/–∫–≥' : '';
            container.innerHTML = flavors.map(f => `
                <div class="flavor-card" onclick="selectFlavor(${f.id})">
                    <span class="flavor-name">${f.name}</span>
                    <span class="flavor-price">${f.price.toLocaleString('ru-RU')} ‚ÇΩ${priceLabel}</span>
                </div>
            `).join('');
        }

        // –í—ã–±–æ—Ä –Ω–∞—á–∏–Ω–∫–∏
        function selectFlavor(flavorId) {
            const flavors = currentItem.category === 'cake' ? cakeFlavors : bentoFlavors;
            currentItem.flavor = flavors.find(f => f.id === flavorId);

            document.getElementById('retail-step2').classList.add('hidden');
            document.getElementById('retail-step3').classList.remove('hidden');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≤–µ—Å–∞
            const weightSection = document.getElementById('weight-section');
            if (currentItem.category === 'bento') {
                weightSection.classList.add('hidden');
                currentItem.weight = 0.8; // 800–≥ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ
                currentItem.customWeight = false;
            } else {
                weightSection.classList.remove('hidden');
                currentItem.weight = 1; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 –∫–≥
                currentItem.customWeight = false;
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≤–µ—Å–∞
                document.querySelectorAll('.weight-btn').forEach(btn => btn.classList.remove('selected'));
                document.querySelector('.weight-btn[data-weight="1"]').classList.add('selected');
                document.querySelector('.big-size-btn').classList.remove('selected');
                document.getElementById('custom-weight-container').classList.remove('show');
                document.getElementById('custom-weight').value = '';
            }

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–µ–∫–æ—Ä–∞
            document.getElementById('retail-decor').value = '';

            updateRetailSummary();
            updateMainButton();
        }

        // –í—ã–±–æ—Ä –≤–µ—Å–∞
        function selectWeight(weight) {
            currentItem.weight = weight;
            currentItem.customWeight = false;
            document.querySelectorAll('.weight-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`.weight-btn[data-weight="${weight}"]`).classList.add('selected');
            document.querySelector('.big-size-btn').classList.remove('selected');
            document.getElementById('custom-weight-container').classList.remove('show');
            document.getElementById('custom-weight').value = '';
            updateRetailSummary();
        }

        // Big size - –∫–∞—Å—Ç–æ–º–Ω—ã–π –≤–µ—Å
        function toggleBigSize() {
            const bigSizeBtn = document.querySelector('.big-size-btn');
            const customContainer = document.getElementById('custom-weight-container');

            if (bigSizeBtn.classList.contains('selected')) {
                // –û—Ç–∫–ª—é—á–∞–µ–º big size, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 1 –∫–≥
                bigSizeBtn.classList.remove('selected');
                customContainer.classList.remove('show');
                currentItem.customWeight = false;
                currentItem.weight = 1;
                document.querySelector('.weight-btn[data-weight="1"]').classList.add('selected');
            } else {
                // –í–∫–ª—é—á–∞–µ–º big size
                document.querySelectorAll('.weight-btn').forEach(btn => btn.classList.remove('selected'));
                bigSizeBtn.classList.add('selected');
                customContainer.classList.add('show');
                currentItem.customWeight = true;
                currentItem.weight = 0; // –ø–æ–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–æ
                document.getElementById('custom-weight').focus();
            }
            updateRetailSummary();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≤–µ—Å–∞
        function updateCustomWeight() {
            const input = document.getElementById('custom-weight');
            const weight = parseFloat(input.value);
            if (weight >= 3.5) {
                currentItem.weight = weight;
                updateRetailSummary();
            } else {
                currentItem.weight = 0;
                updateRetailSummary();
            }
        }

        // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
        function selectDeliveryType(type) {
            retailOrder.deliveryType = type;
            document.querySelectorAll('.delivery-type-btn').forEach(btn => btn.classList.remove('selected'));

            const pickupBlock = document.getElementById('pickup-address-block');
            const addressInput = document.getElementById('retail-address');

            if (type === 'pickup') {
                document.querySelector('.delivery-type-btn:first-child').classList.add('selected');
                pickupBlock.classList.add('show');
                addressInput.classList.add('hidden');
                addressInput.value = '–°–∞–º–æ–≤—ã–≤–æ–∑: –ö–æ—Ñ–µ–π–Ω—è tiramiss\'u, –ù–∞–±. –ú–∞—Ä–∫–∞ –®–∞–≥–∞–ª–∞ 1–∫1';
            } else {
                document.querySelector('.delivery-type-btn:last-child').classList.add('selected');
                pickupBlock.classList.remove('show');
                addressInput.classList.remove('hidden');
                addressInput.value = '';
                addressInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞ (—à–∞–≥ 3)
        function updateRetailSummary() {
            if (!currentItem.flavor) return;

            const flavorName = currentItem.flavor.name;
            const categoryName = currentItem.category === 'cake' ? '–¢–æ—Ä—Ç' : '–ë–µ–Ω—Ç–æ';

            let totalPrice, weightText;

            if (currentItem.category === 'bento') {
                totalPrice = currentItem.flavor.price;
                weightText = '800 –≥—Ä';
            } else {
                totalPrice = currentItem.weight > 0 ? currentItem.flavor.price * currentItem.weight : 0;
                weightText = currentItem.weight > 0 ? `${currentItem.weight} –∫–≥` : '‚Äî';
            }

            document.getElementById('selected-flavor-name').textContent = `${categoryName}: ${flavorName}`;
            document.getElementById('selected-flavor-price').textContent = totalPrice > 0 ? `${totalPrice.toLocaleString('ru-RU')} ‚ÇΩ` : '‚Äî';

            document.getElementById('retail-summary-product').textContent = `${categoryName}: ${flavorName}`;
            document.getElementById('retail-summary-weight').textContent = weightText;
            document.getElementById('retail-total-price').textContent = totalPrice > 0 ? `${totalPrice.toLocaleString('ru-RU')} ‚ÇΩ` : '‚Äî';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ MainButton –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function updateMainButton() {
            const step3 = document.getElementById('retail-step3');
            const step4 = document.getElementById('retail-step4');

            if (!step3.classList.contains('hidden')) {
                // –ù–∞ —à–∞–≥–µ 3 - –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                tg.MainButton.text = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É';
                tg.MainButton.show();
            } else if (!step4.classList.contains('hidden')) {
                // –ù–∞ —à–∞–≥–µ 4 - –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                const total = getCartTotal();
                tg.MainButton.text = `–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ ${total.toLocaleString('ru-RU')} ‚ÇΩ`;
                tg.MainButton.show();
            } else {
                tg.MainButton.hide();
            }
        }

        // –ü–æ–¥—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã –∫–æ—Ä–∑–∏–Ω—ã
        function getCartTotal() {
            return cart.reduce((sum, item) => sum + item.price, 0);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
        function addToCart() {
            const decor = document.getElementById('retail-decor').value.trim();

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (currentItem.category === 'cake' && currentItem.weight <= 0) {
                document.getElementById('retail-step3-error').classList.add('show');
                return false;
            }
            if (!decor) {
                document.getElementById('retail-step3-error').classList.add('show');
                document.getElementById('retail-decor').classList.add('error');
                return false;
            }

            document.getElementById('retail-step3-error').classList.remove('show');
            document.getElementById('retail-decor').classList.remove('error');

            // –°—á–∏—Ç–∞–µ–º —Ü–µ–Ω—É
            let price, weightText;
            if (currentItem.category === 'bento') {
                price = currentItem.flavor.price;
                weightText = '800 –≥—Ä';
            } else {
                price = currentItem.flavor.price * currentItem.weight;
                weightText = `${currentItem.weight} –∫–≥`;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É
            cart.push({
                id: Date.now(),
                category: currentItem.category,
                categoryName: currentItem.category === 'cake' ? '–¢–æ—Ä—Ç' : '–ë–µ–Ω—Ç–æ',
                flavor: currentItem.flavor.name,
                weight: currentItem.weight,
                weightText: weightText,
                customWeight: currentItem.customWeight,
                decor: decor,
                price: price
            });

            updateCartBadge();
            return true;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
        function removeFromCart(itemId) {
            const index = cart.findIndex(item => item.id === itemId);
            if (index > -1) {
                cart.splice(index, 1);
            }
            renderCartItems();
            updateCartBadge();
            updateCartSummary();

            // –ï—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≤—ã–±–æ—Ä—É
            if (cart.length === 0) {
                goToStep(1);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞ –∫–æ—Ä–∑–∏–Ω—ã
        function updateCartBadge() {
            const badge = document.getElementById('cart-badge');
            const count = document.getElementById('cart-count');
            const step4 = document.getElementById('retail-step4');

            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–π–¥–∂ –µ—Å–ª–∏ –º—ã —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ (—à–∞–≥ 4)
            if (!step4.classList.contains('hidden')) {
                badge.classList.remove('show');
                return;
            }

            if (cart.length > 0) {
                badge.classList.add('show');
                count.textContent = cart.length;
            } else {
                badge.classList.remove('show');
            }
        }

        // –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
        function renderCartItems() {
            const container = document.getElementById('cart-items-list');
            container.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <button class="cart-item-remove" onclick="removeFromCart(${item.id})">√ó</button>
                    <div class="cart-item-header">
                        <div class="cart-item-name">${item.categoryName}: ${item.flavor}</div>
                        <div class="cart-item-price">${item.price.toLocaleString('ru-RU')} ‚ÇΩ</div>
                    </div>
                    <div class="cart-item-details">
                        <div>–í–µ—Å: ${item.weightText}</div>
                        <div>–î–µ–∫–æ—Ä: ${item.decor}</div>
                    </div>
                </div>
            `).join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã
        function updateCartSummary() {
            document.getElementById('cart-items-count').textContent = cart.length;
            document.getElementById('cart-total-price').textContent = `${getCartTotal().toLocaleString('ru-RU')} ‚ÇΩ`;
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–æ—Ä–∑–∏–Ω—É
        function goToCart() {
            goToStep(4);
        }

        // –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ç–æ–≤–∞—Ä
        function addMoreItems() {
            goToStep(1);
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —à–∞–≥
        function goToStep(step) {
            document.getElementById('retail-step1').classList.add('hidden');
            document.getElementById('retail-step2').classList.add('hidden');
            document.getElementById('retail-step3').classList.add('hidden');
            document.getElementById('retail-step4').classList.add('hidden');

            document.getElementById(`retail-step${step}`).classList.remove('hidden');

            if (step === 4) {
                renderCartItems();
                updateCartSummary();
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É
                document.getElementById('retail-date').min = retailMinDate.toISOString().split('T')[0];
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ—Ä–∑–∏–Ω—ã –∫–æ–≥–¥–∞ —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
                document.getElementById('cart-badge').classList.remove('show');
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ—Ä–∑–∏–Ω—ã –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã
                updateCartBadge();
            }

            updateMainButton();
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥
        function retailGoBack(toStep) {
            if (toStep === 1) {
                document.getElementById('retail-step2').classList.add('hidden');
                document.getElementById('retail-step1').classList.remove('hidden');
                currentItem.category = null;
                updateMainButton();
            } else if (toStep === 2) {
                document.getElementById('retail-step3').classList.add('hidden');
                document.getElementById('retail-step2').classList.remove('hidden');
                currentItem.flavor = null;
                updateMainButton();
            } else if (toStep === 3) {
                // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Ç–æ–≤–∞—Ä—É
                if (cart.length > 0) {
                    goToStep(1); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≤—ã–±–æ—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                } else {
                    goToStep(1);
                }
            }
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –∫–æ—Ä–∑–∏–Ω—ã (—à–∞–≥ 4)
        function validateRetailForm() {
            let isValid = true;
            const errorMessage = document.getElementById('retail-error-message');

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
            document.querySelectorAll('#retail-step4 .error').forEach(el => el.classList.remove('error'));
            errorMessage.classList.remove('show');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞
            if (cart.length === 0) {
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—É
            const date = document.getElementById('retail-date');
            if (!date.value) {
                date.classList.add('error');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è
            const time = document.getElementById('retail-time');
            if (!time.value) {
                time.classList.add('error');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥—Ä–µ—Å —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
            if (retailOrder.deliveryType === 'delivery') {
                const address = document.getElementById('retail-address');
                if (!address.value.trim()) {
                    address.classList.add('error');
                    isValid = false;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º—è
            const name = document.getElementById('retail-name');
            if (!name.value.trim()) {
                name.classList.add('error');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
            const phone = document.getElementById('retail-phone');
            if (!phone.value.trim()) {
                phone.classList.add('error');
                isValid = false;
            }

            if (!isValid) {
                errorMessage.classList.add('show');
            }

            return isValid;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
        function validateForm() {
            let isValid = true;
            const errorMessage = document.getElementById('error-message');

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
            document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
            errorMessage.classList.remove('show');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—É
            const firstDelivery = document.getElementById('first-delivery');
            if (!firstDelivery.value) {
                firstDelivery.classList.add('error');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–ø–∞–Ω–∏—é
            const company = document.getElementById('company-name');
            if (!company.value.trim()) {
                company.classList.add('error');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
            const phone = document.getElementById('phone');
            if (!phone.value.trim()) {
                phone.classList.add('error');
                isValid = false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥—Ä–µ—Å
            const address = document.getElementById('address');
            if (!address.value.trim()) {
                address.classList.add('error');
                isValid = false;
            }

            if (!isValid) {
                errorMessage.classList.add('show');
            }

            return isValid;
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ–∫—Ü–∏—é
        function getCurrentSection() {
            if (document.getElementById('retail-section').classList.contains('active')) {
                return 'retail';
            }
            return 'b2b';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
        function handlePhotoUpload(input, type) {
            const files = Array.from(input.files);
            const photosArray = type === 'retail' ? retailPhotos : b2bPhotos;
            const previewId = type === 'retail' ? 'retail-photos-preview' : 'b2b-photos-preview';

            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const photoData = {
                            name: file.name,
                            data: e.target.result, // base64
                            size: file.size
                        };
                        photosArray.push(photoData);
                        renderPhotosPreview(type);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ
        function renderPhotosPreview(type) {
            const photosArray = type === 'retail' ? retailPhotos : b2bPhotos;
            const previewId = type === 'retail' ? 'retail-photos-preview' : 'b2b-photos-preview';
            const container = document.getElementById(previewId);

            if (photosArray.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = photosArray.map((photo, index) => `
                <div class="photo-preview-item">
                    <img src="${photo.data}" alt="${photo.name}">
                    <button class="photo-remove" onclick="removePhoto(${index}, '${type}')">√ó</button>
                </div>
            `).join('');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ
        function removePhoto(index, type) {
            const photosArray = type === 'retail' ? retailPhotos : b2bPhotos;
            photosArray.splice(index, 1);
            renderPhotosPreview(type);
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞
        tg.MainButton.onClick(function() {
            const currentSection = getCurrentSection();

            if (currentSection === 'retail') {
                const step3 = document.getElementById('retail-step3');
                const step4 = document.getElementById('retail-step4');

                if (!step3.classList.contains('hidden')) {
                    // –ù–∞ —à–∞–≥–µ 3 - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
                    if (addToCart()) {
                        goToStep(4);
                    }
                    return;
                }

                if (!step4.classList.contains('hidden')) {
                    // –ù–∞ —à–∞–≥–µ 4 - –æ—Ñ–æ—Ä–º–ª—è–µ–º –∑–∞–∫–∞–∑
                    if (!validateRetailForm()) {
                        return;
                    }

                    const orderData = {
                        type: 'retail',
                        user: user ? { id: user.id, name: user.first_name, username: user.username } : null,
                        items: cart.map(item => ({
                            category: item.categoryName,
                            product: item.flavor,
                            weight: item.weightText,
                            customWeight: item.customWeight,
                            decor: item.decor,
                            price: item.price
                        })),
                        totalPrice: getCartTotal(),
                        date: document.getElementById('retail-date').value,
                        time: document.getElementById('retail-time').value,
                        deliveryType: retailOrder.deliveryType,
                        address: retailOrder.deliveryType === 'pickup'
                            ? '–°–∞–º–æ–≤—ã–≤–æ–∑: –ö–æ—Ñ–µ–π–Ω—è tiramiss\'u, –ù–∞–±. –ú–∞—Ä–∫–∞ –®–∞–≥–∞–ª–∞ 1–∫1'
                            : document.getElementById('retail-address').value,
                        customerName: document.getElementById('retail-name').value,
                        phone: document.getElementById('retail-phone').value,
                        allergies: document.getElementById('retail-allergies').value,
                        photos: retailPhotos.map(p => p.data) // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤ base64
                    };

                    tg.sendData(JSON.stringify(orderData));
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ç–æ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                    retailPhotos.length = 0;
                    renderPhotosPreview('retail');
                }

            } else {
                // B2B –∑–∞–∫–∞–∑
                if (!validateForm()) {
                    return;
                }

                order.firstDelivery = document.getElementById('first-delivery').value;
                order.company = document.getElementById('company-name').value;
                order.phone = document.getElementById('phone').value;
                order.address = document.getElementById('address').value;
                order.comment = document.getElementById('comment').value;

                const orderData = {
                    type: 'b2b',
                    user: user ? { id: user.id, name: user.first_name, username: user.username } : null,
                    products: products.filter(p => order.quantities[p.id] > 0).map(p => ({
                        name: p.name,
                        quantity: order.quantities[p.id]
                    })),
                    firstDelivery: order.firstDelivery,
                    days: order.days,
                    company: order.company,
                    phone: order.phone,
                    address: order.address,
                    comment: order.comment,
                    photos: b2bPhotos.map(p => p.data) // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤ base64
                };

                tg.sendData(JSON.stringify(orderData));
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ç–æ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                b2bPhotos.length = 0;
                renderPhotosPreview('b2b');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        renderProducts();
        updateSummary();
    </script>
</body>
</html>
